<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Elgg: ElggDatabase Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Elgg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">ElggDatabase Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab03d0ccdf0ecf9faa220b24f6e990fd0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#ab03d0ccdf0ecf9faa220b24f6e990fd0">getLink</a> ($dblinktype)</td></tr>
<tr class="separator:ab03d0ccdf0ecf9faa220b24f6e990fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e6b58c4fe0918754b4a651f642c83dd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a1e6b58c4fe0918754b4a651f642c83dd">setupConnections</a> ()</td></tr>
<tr class="separator:a1e6b58c4fe0918754b4a651f642c83dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1562b518f5ff546e6dbe31372df13c0b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a1562b518f5ff546e6dbe31372df13c0b">establishLink</a> ($dblinkname=&quot;readwrite&quot;)</td></tr>
<tr class="separator:a1562b518f5ff546e6dbe31372df13c0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84817d94028f09ceddd34c359b0620e4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a84817d94028f09ceddd34c359b0620e4">getData</a> ($query, $callback= '')</td></tr>
<tr class="separator:a84817d94028f09ceddd34c359b0620e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b7a9bfbc30ebdf93c83f1e06a0ed78"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a39b7a9bfbc30ebdf93c83f1e06a0ed78">getDataRow</a> ($query, $callback= '')</td></tr>
<tr class="separator:a39b7a9bfbc30ebdf93c83f1e06a0ed78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d981d9af92db4b9a5c17f9b70479419"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a7d981d9af92db4b9a5c17f9b70479419">insertData</a> ($query)</td></tr>
<tr class="separator:a7d981d9af92db4b9a5c17f9b70479419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03538952b16aabb64aa44cf502cbc62d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a03538952b16aabb64aa44cf502cbc62d">updateData</a> ($query)</td></tr>
<tr class="separator:a03538952b16aabb64aa44cf502cbc62d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a048eddc791875f2fdf45068c3cbdc472"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a048eddc791875f2fdf45068c3cbdc472">deleteData</a> ($query)</td></tr>
<tr class="separator:a048eddc791875f2fdf45068c3cbdc472"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e87ad77ec3e3162b7f3e79bfc6ad708"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a4e87ad77ec3e3162b7f3e79bfc6ad708">executeQuery</a> ($query, $dblink)</td></tr>
<tr class="separator:a4e87ad77ec3e3162b7f3e79bfc6ad708"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62486d8735623f2e87ae3bac7dbde981"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a62486d8735623f2e87ae3bac7dbde981">runSqlScript</a> ($scriptlocation)</td></tr>
<tr class="separator:a62486d8735623f2e87ae3bac7dbde981"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9caffedd382788d69ca100009762f07"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#aa9caffedd382788d69ca100009762f07">registerDelayedQuery</a> ($query, $dblink, $handler=&quot;&quot;)</td></tr>
<tr class="separator:aa9caffedd382788d69ca100009762f07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8987da9c290c1cfb34f6b295bbb7361"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#ab8987da9c290c1cfb34f6b295bbb7361">executeDelayedQueries</a> ()</td></tr>
<tr class="separator:ab8987da9c290c1cfb34f6b295bbb7361"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a61b9097ace78236a1a7f9cfd9e9ab01c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_elgg_database.html#a61b9097ace78236a1a7f9cfd9e9ab01c">getTables</a> ()</td></tr>
<tr class="separator:a61b9097ace78236a1a7f9cfd9e9ab01c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An object representing a single <a class="el" href="namespace_elgg.html">Elgg</a> database.</p>
<p>WARNING: THIS API IS IN FLUX. PLUGIN AUTHORS SHOULD NOT USE. See lib/database.php instead.</p>
<p>TODO: Convert query cache to a private local variable (or remove completely). TODO: Convert delayed queries to private local variable. TODO: Convert db link registry to private local variable.</p>
<p>private </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a048eddc791875f2fdf45068c3cbdc472"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">deleteData </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove a row from the database.</p>
<dl class="section note"><dt>Note</dt><dd>Altering the DB invalidates all queries in <a class="el" href="">$DB_QUERY_CACHE</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>The SQL query to run</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int|false The number of affected rows or false on failure  private </dd></dl>

</div>
</div>
<a class="anchor" id="a1562b518f5ff546e6dbe31372df13c0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">establishLink </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dblinkname</em> = <code>&quot;readwrite&quot;</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Establish a connection to the database servser</p>
<p>Connect to the database server and use the <a class="el" href="namespace_elgg.html">Elgg</a> database for a particular database link</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dblinkname</td><td>The type of database connection. Used to identify the resource. eg "read", "write", or "readwrite".</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void  private </dd></dl>

</div>
</div>
<a class="anchor" id="ab8987da9c290c1cfb34f6b295bbb7361"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">executeDelayedQueries </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Trigger all queries that were registered as "delayed" queries. This is called by the system automatically on shutdown. </p>

</div>
</div>
<a class="anchor" id="a4e87ad77ec3e3162b7f3e79bfc6ad708"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">executeQuery </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dblink</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Execute a query.</p>
<p>$query is executed via <a class="el" href="">mysql_query()</a>. If there is an SQL error, a <a class="el" href="class_database_exception.html">DatabaseException</a> is thrown. </p>

</div>
</div>
<a class="anchor" id="a84817d94028f09ceddd34c359b0620e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getData </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$callback</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve rows from the database.</p>
<p>Queries are executed with <a class="el" href="class_elgg_database.html#a4e87ad77ec3e3162b7f3e79bfc6ad708">ElggDatabase::executeQuery()</a> and results are retrieved with <a class="el" href="">mysql_fetch_object()</a>. If a callback function $callback is defined, each row will be passed as the single argument to $callback. If no callback function is defined, the entire result set is returned as an array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$query</td><td>The query being passed. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$callback</td><td>Optionally, the name of a function to call back to on each row</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array An array of database result objects or callback function results. If the query returned nothing, an empty array.  private </dd></dl>

</div>
</div>
<a class="anchor" id="a39b7a9bfbc30ebdf93c83f1e06a0ed78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getDataRow </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$callback</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve a single row from the database.</p>
<p>Similar to <a class="el" href="class_elgg_database.html#a84817d94028f09ceddd34c359b0620e4">ElggDatabase::getData()</a> but returns only the first row matched. If a callback function $callback is specified, the row will be passed as the only argument to $callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$query</td><td>The query to execute. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$callback</td><td>A callback function</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mixed A single database result object or the result of the callback function.  private </dd></dl>

</div>
</div>
<a class="anchor" id="ab03d0ccdf0ecf9faa220b24f6e990fd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getLink </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dblinktype</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns (if required, also creates) a database link resource.</p>
<p>Database link resources are stored in the <a class="el" href="">$dblink</a> global. These resources are created by <a class="el" href="">setup_db_connections()</a>, which is called if no links exist.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dblinktype</td><td>The type of link we want: "read", "write" or "readwrite".</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>object Database link  private </dd></dl>

</div>
</div>
<a class="anchor" id="a61b9097ace78236a1a7f9cfd9e9ab01c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">getTables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return tables matching the database prefix <a class="el" href="">-&gt;tablePrefix</a>% in the currently selected database.</p>
<dl class="section return"><dt>Returns</dt><dd>array|false List of tables or false on failure array $tables Tables found matching the database prefix  private </dd></dl>

</div>
</div>
<a class="anchor" id="a7d981d9af92db4b9a5c17f9b70479419"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">insertData </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Insert a row into the database.</p>
<dl class="section note"><dt>Note</dt><dd>Altering the DB invalidates all queries in <a class="el" href="">$DB_QUERY_CACHE</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$query</td><td>The query to execute.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int|false The database id of the inserted row if a AUTO_INCREMENT field is defined, 0 if not, and false on failure.  private </dd></dl>

</div>
</div>
<a class="anchor" id="aa9caffedd382788d69ca100009762f07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">registerDelayedQuery </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dblink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$handler</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Queue a query for execution upon shutdown.</p>
<p>You can specify a handler function if you care about the result. This function will accept the raw result from <a class="el" href="">mysql_query()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>The query to execute </td></tr>
    <tr><td class="paramtype">resource</td><td class="paramname">$dblink</td><td>The database link to use or the link type (read | write) </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$handler</td><td>A callback function to pass the results array to</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>boolean Whether registering was successful.  private </dd></dl>

</div>
</div>
<a class="anchor" id="a62486d8735623f2e87ae3bac7dbde981"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">runSqlScript </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$scriptlocation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Runs a full database script from disk.</p>
<p>The file specified should be a standard SQL file as created by mysqldump or similar. Statements must be terminated with ; and a newline character (<br/>
 or <br/>
) with only one statement per line.</p>
<p>The special string 'prefix_' is replaced with the database prefix as defined in <a class="el" href="">-&gt;tablePrefix</a>.</p>
<dl class="section warning"><dt>Warning</dt><dd>Errors do not halt execution of the script. If a line generates an error, the error message is saved and the next line is executed. After the file is run, any errors are displayed as a <a class="el" href="class_database_exception.html">DatabaseException</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$scriptlocation</td><td>The full path to the script</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="class_database_exception.html">DatabaseException</a></td><td>private </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1e6b58c4fe0918754b4a651f642c83dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">setupConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Establish database connections</p>
<p>If the configuration has been set up for multiple read/write databases, set those links up separately; otherwise just create the one database link.</p>
<dl class="section return"><dt>Returns</dt><dd>void  private </dd></dl>

</div>
</div>
<a class="anchor" id="a03538952b16aabb64aa44cf502cbc62d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">updateData </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update a row in the database.</p>
<dl class="section note"><dt>Note</dt><dd>Altering the DB invalidates all queries in <a class="el" href="">$DB_QUERY_CACHE</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>The query to run.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool  private </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/Users/markborcherding/source/vendor/Elgg/engine/classes/ElggDatabase.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 30 2012 09:32:41 for Elgg by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
